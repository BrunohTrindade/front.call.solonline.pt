import{r,l as st,j as e,c as at,n as $e,t as dt,o as ct,u as pt,p as mt,s as y,q as Me}from"./index-DUMhbAof.js";import{d as nt,g as ot,t as ut,F as xt,a as rt,h as te,c as it,m as ht,v as ne,e as Be,A as ft,T as gt,B as c,C as q,i as jt,I as Re,L as Ke,D as Ge,f as I,j as Ye,k as Je,M as yt,l as bt,n as vt,o as We,p as Ee,q as Le,S as wt,r as Qe}from"./Menu-D2QxTdDQ.js";import{O as St,f as Ct,g as It,I as Pt,d as kt,S as Tt,F as Nt,P as Xe,A as Mt,a as Wt,h as Et,M as De,D as Lt,b as Ft,c as At,e as _t}from"./PeopleOutline-Bd9CJoFf.js";function zt(m){return ot("MuiInputAdornment",m)}const Ze=nt("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var et;const Rt=(m,g)=>{const{ownerState:w}=m;return[g.root,g[`position${$e(w.position)}`],w.disablePointerEvents===!0&&g.disablePointerEvents,g[w.variant]]},Dt=m=>{const{classes:g,disablePointerEvents:w,hiddenLabel:z,position:M,size:R,variant:o}=m,U={root:["root",w&&"disablePointerEvents",M&&`position${$e(M)}`,o,z&&"hiddenLabel",R&&`size${$e(R)}`]};return it(U,zt,g)},$t=rt("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:Rt})(ht(({theme:m})=>({display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(m.vars||m).palette.action.active,variants:[{props:{variant:"filled"},style:{[`&.${Ze.positionStart}&:not(.${Ze.hiddenLabel})`]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}))),Bt=r.forwardRef(function(g,w){const z=st({props:g,name:"MuiInputAdornment"}),{children:M,className:R,component:o="div",disablePointerEvents:U=!1,disableTypography:X=!1,position:W,variant:D,...i}=z,P=ut()||{};let x=D;D&&P.variant,P&&!x&&(x=P.variant);const b={...z,hiddenLabel:P.hiddenLabel,size:P.size,disablePointerEvents:U,position:W,variant:x},E=Dt(b);return e.jsx(xt.Provider,{value:null,children:e.jsx($t,{as:o,ownerState:b,className:at(E.root,R),ref:w,...i,children:typeof M=="string"&&!X?e.jsx(te,{color:"textSecondary",children:M}):e.jsxs(r.Fragment,{children:[W==="start"?et||(et=e.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):null,M]})})})});function Ht(m){return ot("MuiTextField",m)}nt("MuiTextField",["root"]);const Ot={standard:It,filled:Ct,outlined:St},qt=m=>{const{classes:g}=m;return it({root:["root"]},Ht,g)},Ut=rt(Nt,{name:"MuiTextField",slot:"Root"})({}),Vt=r.forwardRef(function(g,w){const z=st({props:g,name:"MuiTextField"}),{autoComplete:M,autoFocus:R=!1,children:o,className:U,color:X="primary",defaultValue:W,disabled:D=!1,error:i=!1,FormHelperTextProps:P,fullWidth:x=!1,helperText:b,id:E,InputLabelProps:He,inputProps:s,InputProps:V,inputRef:me,label:j,maxRows:ue,minRows:K,multiline:k=!1,name:L,onBlur:T,onChange:oe,onFocus:xe,placeholder:he,required:re=!1,rows:fe,select:G=!1,SelectProps:Z,slots:S={},slotProps:Fe={},type:f,value:ee,variant:$="outlined",...Y}=z,C={...z,autoFocus:R,color:X,disabled:D,error:i,fullWidth:x,multiline:k,required:re,select:G,variant:$},se=qt(C),B=dt(E),F=b&&B?`${B}-helper-text`:void 0,ie=j&&B?`${B}-label`:void 0,ge=Ot[$],H={slots:S,slotProps:{input:V,inputLabel:He,htmlInput:s,formHelperText:P,select:Z,...Fe}},J={},le=H.slotProps.inputLabel;$==="outlined"&&(le&&typeof le.shrink<"u"&&(J.notched=le.shrink),J.label=j),G&&((!Z||!Z.native)&&(J.id=void 0),J["aria-describedby"]=void 0);const[de,je]=ne("root",{elementType:Ut,shouldForwardComponentProp:!0,externalForwardedProps:{...H,...Y},ownerState:C,className:at(se.root,U),ref:w,additionalProps:{disabled:D,error:i,fullWidth:x,required:re,color:X,variant:$}}),[ye,A]=ne("input",{elementType:ge,externalForwardedProps:H,additionalProps:J,ownerState:C}),[be,ve]=ne("inputLabel",{elementType:Pt,externalForwardedProps:H,ownerState:C}),[we,Se]=ne("htmlInput",{elementType:"input",externalForwardedProps:H,ownerState:C}),[Ae,_e]=ne("formHelperText",{elementType:kt,externalForwardedProps:H,ownerState:C}),[Ce,Ie]=ne("select",{elementType:Tt,externalForwardedProps:H,ownerState:C}),ce=e.jsx(ye,{"aria-describedby":F,autoComplete:M,autoFocus:R,defaultValue:W,fullWidth:x,multiline:k,name:L,rows:fe,maxRows:ue,minRows:K,type:f,value:ee,id:B,inputRef:me,onBlur:T,onChange:oe,onFocus:xe,placeholder:he,inputProps:Se,slots:{input:S.htmlInput?we:void 0},...A});return e.jsxs(de,{...je,children:[j!=null&&j!==""&&e.jsx(be,{htmlFor:B,id:ie,...ve,children:j}),G?e.jsx(Ce,{"aria-describedby":F,id:B,labelId:ie,value:ee,input:ce,...Ie,children:o}):ce,b&&e.jsx(Ae,{id:F,..._e,children:b})]})}),Kt=Be(e.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"})),Gt=Be(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"})),tt=Be(e.jsx("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}));function Xt(){var Ce,Ie,ce,Oe,qe,Ue,Ve;const m=ct(),{listContacts:g,updateContact:w,getContact:z,listContactsStats:M,deleteContact:R}=m,{user:o,logout:U}=pt(),X=((Ce=m.getDisplayName)==null?void 0:Ce.call(m))||"",{mode:W,toggle:D}=mt(),[i,P]=r.useState({data:[],meta:{}}),[x,b]=r.useState(1),[E,He]=r.useState(50),[s,V]=r.useState(null),[me,j]=r.useState(""),[ue,K]=r.useState(""),[k,L]=r.useState(!1),[T,oe]=r.useState({}),xe=r.useRef(null),he=r.useRef(null),re=r.useRef(null),fe=r.useRef(null),[G,Z]=r.useState({total:0,processed:0,pending:0}),[S,Fe]=r.useState(""),[f,ee]=r.useState("all"),[$,Y]=r.useState(null),[C,se]=r.useState(!1),[B,F]=r.useState(!1),[ie,ge]=r.useState(null),[H,J]=r.useState(null),[le,de]=r.useState(null),[je,ye]=r.useState("");r.useMemo(()=>`Olá, aqui é da Agência SolOnline.
Texto de abordagem e roteiro...`,[]);async function A(){var a,n;const t=f==="pending"?"pending":f==="processed"?"processed":"";try{const l=m.getContactsSnapshot(x,E,{q:S,status:t});l&&P(h=>{var pe,ke,Te;return((pe=h==null?void 0:h.meta)==null?void 0:pe.current_page)===((ke=l==null?void 0:l.meta)==null?void 0:ke.current_page)&&((Te=h==null?void 0:h.data)!=null&&Te.length)?h:l});const d=m.getContactsStatsSnapshot();d&&Z(h=>h!=null&&h.total?h:{total:d.total||0,processed:d.processed||0,pending:d.pending||0});const u=g(x,E,{q:S,status:t}),Q=M().catch(()=>({total:0,processed:0,pending:0})),ze=sessionStorage.getItem("snapshot:settings:script");if(ze)try{const h=JSON.parse(ze);((a=h==null?void 0:h.data)==null?void 0:a.script)!=null&&ye(String(h.data.script||""))}catch{}const Pe=m.getScript().catch(()=>({script:""})),p=await u;P(p);const v=Array.isArray(p==null?void 0:p.data)?p.data.length:0,_=((n=p==null?void 0:p.meta)==null?void 0:n.current_page)||x;v===0&&_>1&&b(_-1);const N=await Q;Z({total:N.total||0,processed:N.processed||0,pending:N.pending||0});const O=await Pe;return ye(String((O==null?void 0:O.script)||"")),{res:p,s:N}}catch{return null}}r.useEffect(()=>{A()},[x,E]),r.useEffect(()=>{o!=null&&o.is_admin||(f!=="all"&&ee("all"),$&&Y(null))},[o==null?void 0:o.is_admin,f,$]),r.useEffect(()=>{var n;const t=f==="pending"?"pending":f==="processed"?"processed":"",a=((n=i==null?void 0:i.meta)==null?void 0:n.last_page)||1;x<a&&g(x+1,E,{q:S,status:t}).catch(()=>{})},[x,E,(Ie=i==null?void 0:i.meta)==null?void 0:Ie.last_page,S,f]),r.useEffect(()=>{function t(){const a=re.current;if(!a){de(null);return}const n=a.querySelector("li.list-item");if(!n){de(null);return}const l=n.offsetHeight||0;let d=0;try{const Q=window.getComputedStyle(n);d=parseFloat(Q.marginBottom||"0")||0}catch{}const u=l*9+d*8;de(Math.ceil(u+2))}return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[i,S,f,s,k,T]),r.useEffect(()=>{if(k)return;const t=setTimeout(()=>{x!==1?b(1):A()},250);return()=>clearTimeout(t)},[S,f]),r.useEffect(()=>{function t(){A()}function a(){document.hidden||A()}window.addEventListener("focus",t),document.addEventListener("visibilitychange",a);const n=m.openContactsStream({onChange:()=>{k||A()}});return()=>{window.removeEventListener("focus",t),document.removeEventListener("visibilitychange",a),n&&n()}},[]),r.useEffect(()=>{const t=setInterval(()=>{!document.hidden&&!k&&A()},3e4);return()=>clearInterval(t)},[]),r.useEffect(()=>{function t(n){var u,Q;if(C||!s)return;const l=(u=he.current)==null?void 0:u.contains(n.target),d=(Q=fe.current)==null?void 0:Q.contains(n.target);!l&&!d&&(V(null),j(""),L(!1))}function a(n){C||s&&n.key==="Escape"&&(V(null),j(""),L(!1))}return document.addEventListener("mousedown",t),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",a)}},[s,C]);const be=r.useMemo(()=>((i==null?void 0:i.data)||[]).reduce((t,a)=>{const n=T[a.id],l=a.observacao||"",d=typeof n=="string"&&n!==l;return a.processed_at&&d?t+1:t},0),[i,T]),ve=Math.max(0,(G.pending||0)+be),we=Math.max(0,(G.processed||0)-be);async function Se(t){const a=await z(t);V(a);const n=T[t],l=(a==null?void 0:a.observacao)||"",d=typeof n=="string"?n:l;j(d),L(d!==l)}async function Ae(){if(s){K("Salvando...");try{const t=await w(s.id,{observacao:me});K("Salvo!"),V(a=>a&&{...a,observacao:t.observacao,processed_at:t.processed_at}),j(""),L(!1),oe(a=>{const n={...a};return delete n[s.id],n}),await A()}catch(t){K("Erro: "+t.message)}}}async function _e(t){var n,l;const a=t??(s==null?void 0:s.id);if(a){K("Excluindo...");try{await R(a),K("Excluído"),P(p=>{const v=Array.isArray(p==null?void 0:p.data)?[...p.data]:[],_=(p==null?void 0:p.meta)||{},N=v.findIndex(ae=>ae.id===a);if(N===-1)return p;const O=v[N],h=(O==null?void 0:O.numero)??null;if(v.splice(N,1),h!=null)for(let ae=0;ae<v.length;ae++){const Ne=v[ae];typeof Ne.numero=="number"&&Ne.numero>h&&(v[ae]={...Ne,numero:Ne.numero-1})}const pe=(_.total||0)-1,ke=_.per_page||E,Te=Math.max(1,Math.ceil(Math.max(0,pe)/Math.max(1,ke))),lt={..._,total:pe,last_page:Te};return{...p,data:v,meta:lt}}),Z(p=>{const _=(Array.isArray(i==null?void 0:i.data)?i.data:[]).find(O=>O.id===a),N=!!(_!=null&&_.processed_at);return{total:Math.max(0,(p.total||0)-1),processed:Math.max(0,(p.processed||0)-(N?1:0)),pending:Math.max(0,(p.pending||0)-(N?0:1))}}),(s==null?void 0:s.id)===a&&V(null),j(""),L(!1),oe(p=>{const v={...p};return delete v[a],v});const d=await A(),u=d==null?void 0:d.res,Q=Array.isArray(u==null?void 0:u.data)?u.data.length>0:!1,ze=((n=u==null?void 0:u.meta)==null?void 0:n.last_page)||1,Pe=((l=u==null?void 0:u.meta)==null?void 0:l.current_page)||x;!Q&&Pe>1&&b(Pe-1)}catch(d){K("Erro: "+d.message)}}}return e.jsxs(e.Fragment,{children:[e.jsx(ft,{position:"static",color:"default",enableColorOnDark:!0,sx:{bgcolor:"background.paper",borderBottom:t=>`1px solid ${t.palette.divider}`},children:e.jsxs(gt,{sx:{gap:2,minHeight:72},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5,flex:1,minWidth:0},children:[e.jsx(c,{className:"app-brand","aria-hidden":!0,sx:{width:40,height:40,display:"grid",placeItems:"center",color:"primary.contrastText",bgcolor:"primary.main",borderRadius:1.2},children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"8",ry:"3",fill:"currentColor"}),e.jsx("path",{d:"M4 5v6c0 1.66 3.58 3 8 3s8-1.34 8-3V5",fill:"currentColor",opacity:".9"}),e.jsx("path",{d:"M4 11v6c0 1.66 3.58 3 8 3s8-1.34 8-3v-6",fill:"currentColor",opacity:".8"})]})}),e.jsxs(c,{sx:{minWidth:0},children:[e.jsx(te,{variant:"h6",sx:{fontWeight:700,lineHeight:1.15,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Módulo de Movimentação"}),e.jsx(te,{variant:"caption",color:"text.secondary",children:"Gerenciamento de Registros"})]})]}),e.jsxs(c,{sx:{display:{xs:"none",sm:"flex"},alignItems:"center",gap:1.25},children:[e.jsx(q,{size:"small",variant:"filled",icon:e.jsx(c,{sx:{width:8,height:8,bgcolor:"success.main",borderRadius:"50%"}}),label:"Sistema Online",sx:t=>({bgcolor:y(t.palette.success.main,.12),color:t.palette.success.main,"& .MuiChip-icon":{color:t.palette.success.main},fontWeight:500,borderRadius:1.5})}),X&&e.jsx(q,{size:"small",label:X,sx:t=>({bgcolor:t.palette.mode==="dark"?y(t.palette.grey[700],.25):y(t.palette.grey[200],.7),borderRadius:1.5,fontWeight:600})}),e.jsx(jt,{title:W==="dark"?"Tema: Escuro (clique para Claro)":"Tema: Claro (clique para Escuro)",children:e.jsx(Re,{color:"inherit",onClick:D,"aria-label":"Alternar tema",sx:{borderRadius:2,transition:"all .2s ease","&:hover":{bgcolor:t=>y(t.palette.text.primary,.06),transform:"translateY(-1px)"}},children:W==="dark"?e.jsx(Ke,{fontSize:"small"}):e.jsx(Ge,{fontSize:"small"})})}),(o==null?void 0:o.is_admin)&&e.jsx(te,{variant:"body2",sx:{fontWeight:600},children:"Admin"}),(o==null?void 0:o.is_admin)&&e.jsx(I,{variant:"outlined",size:"small",startIcon:e.jsx(Xe,{}),component:Me,to:"/admin/usuarios",sx:t=>({textTransform:"uppercase",letterSpacing:".35px",borderRadius:2,borderColor:y(t.palette.primary.main,.4),color:t.palette.primary.main,fontWeight:700,"&:hover":{borderColor:t.palette.primary.main,boxShadow:"0 2px 8px rgba(0,0,0,.08)"}}),children:"Usuários"}),e.jsx(Ye,{orientation:"vertical",flexItem:!0,sx:{mx:.5,opacity:.4}}),o&&e.jsx(I,{variant:"text",color:"inherit",size:"small",startIcon:e.jsx(Je,{}),onClick:U,sx:{fontWeight:700,color:"text.primary","&:hover":{bgcolor:t=>y(t.palette.text.primary,.06)}},children:"Sair"})]}),e.jsx(c,{sx:{display:{xs:"flex",sm:"none"}},children:e.jsx(Re,{"aria-label":"Abrir menu",onClick:()=>F(!0),children:e.jsx(yt,{})})})]})}),e.jsx(bt,{anchor:"right",open:B,onClose:()=>F(!1),sx:{display:{xs:"block",sm:"none"}},children:e.jsxs(c,{sx:{width:300},role:"presentation",onKeyDown:t=>{t.key==="Escape"&&F(!1)},children:[e.jsxs(c,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(te,{variant:"subtitle1",sx:{fontWeight:700},children:"Menu"}),e.jsx(q,{size:"small",label:"Sistema Online",color:"success",variant:"outlined"})]}),e.jsx(Ye,{}),e.jsxs(vt,{children:[e.jsxs(We,{onClick:()=>{D()},children:[e.jsx(Ee,{children:W==="dark"?e.jsx(Ke,{}):e.jsx(Ge,{})}),e.jsx(Le,{primary:`Tema: ${W==="dark"?"Escuro":"Claro"}`}),e.jsx(wt,{edge:"end",checked:W==="dark",onChange:D})]}),(o==null?void 0:o.is_admin)&&e.jsxs(We,{component:Me,to:"/importacao",onClick:()=>F(!1),children:[e.jsx(Ee,{children:e.jsx(tt,{})}),e.jsx(Le,{primary:"Importar"})]}),(o==null?void 0:o.is_admin)&&e.jsxs(We,{component:Me,to:"/admin/usuarios",onClick:()=>F(!1),children:[e.jsx(Ee,{children:e.jsx(Xe,{})}),e.jsx(Le,{primary:"Usuários"})]}),o&&e.jsxs(We,{onClick:()=>{F(!1),U()},children:[e.jsx(Ee,{children:e.jsx(Je,{})}),e.jsx(Le,{primary:"Sair"})]})]})]})}),e.jsx(c,{sx:{width:"100%",bgcolor:t=>t.palette.mode==="light"?"#f7f9fb":y("#ffffff",.03),py:{xs:2,sm:3},minHeight:"calc(100dvh - 72px)"},children:e.jsxs(Qe,{maxWidth:"xl",sx:{px:{xs:2,sm:3}},children:[je&&e.jsx(c,{className:"card",sx:{mb:2},children:e.jsxs(Mt,{severity:"info",children:[e.jsx(Wt,{children:"Aviso da Administração"}),e.jsx("div",{style:{whiteSpace:"pre-wrap"},children:je})]})}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:{xs:2,sm:2.5}},children:[e.jsxs("div",{className:"card",ref:he,style:{display:"flex",flexDirection:"column",gap:12,minWidth:0,minHeight:0},children:[e.jsxs(c,{sx:{display:"flex",alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between",flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[e.jsx(te,{variant:"h6",sx:{fontWeight:700},children:"Lista de Registros"}),(o==null?void 0:o.is_admin)&&e.jsxs(c,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:{xs:1,sm:0},justifyContent:{xs:"flex-start",sm:"flex-end"}},children:[e.jsx(q,{size:"small",label:`${G.total} registros`,sx:t=>({bgcolor:t.palette.mode==="dark"?y(t.palette.primary.light,.18):y(t.palette.primary.main,.12),color:t.palette.primary.main,fontWeight:600,borderRadius:2})}),e.jsx(q,{size:"small",label:`${ve} pendentes`,sx:t=>({bgcolor:t.palette.mode==="dark"?y(t.palette.error.light,.18):y(t.palette.error.main,.12),color:t.palette.error.main,fontWeight:600,borderRadius:2})}),e.jsx(q,{size:"small",label:`${we} processados`,sx:t=>({bgcolor:t.palette.mode==="dark"?y(t.palette.success.light,.2):y(t.palette.success.main,.18),color:t.palette.success.dark,fontWeight:600,borderRadius:2})})]})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(Vt,{size:"medium",placeholder:"Buscar registros...",value:S,onChange:t=>Fe(t.target.value),fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:999,bgcolor:t=>t.palette.mode==="dark"?y(t.palette.common.white,.04):t.palette.common.white,height:48},flex:{xs:"1 1 100%",sm:"1 1 65%",md:"1 1 60%"},maxWidth:{xs:"100%",md:560}},InputProps:{startAdornment:e.jsx(Bt,{position:"start",children:e.jsx(Gt,{fontSize:"small",sx:{color:"text.secondary"}})})}}),(o==null?void 0:o.is_admin)&&e.jsxs(e.Fragment,{children:[e.jsx(Re,{"aria-label":"Filtrar",onClick:t=>Y(t.currentTarget),sx:t=>({width:48,height:48,borderRadius:1.75,bgcolor:t.palette.primary.main,color:t.palette.primary.contrastText,boxShadow:t.shadows[1],"&:hover":{bgcolor:t.palette.primary.dark,boxShadow:t.shadows[2]}}),children:e.jsx(Kt,{})}),e.jsxs(Et,{anchorEl:$,open:!!$,onClose:()=>Y(null),children:[e.jsx(De,{selected:f==="all",onClick:()=>{ee("all"),Y(null)},children:"Todos"}),e.jsx(De,{selected:f==="pending",onClick:()=>{ee("pending"),Y(null)},children:"Pendentes"}),e.jsx(De,{selected:f==="processed",onClick:()=>{ee("processed"),Y(null)},children:"Processados"})]})]}),(o==null?void 0:o.is_admin)&&e.jsx(I,{variant:"contained",color:"success",size:"large",startIcon:e.jsx(tt,{}),component:Me,to:"/importacao",sx:{height:48,px:2.25,fontWeight:800,letterSpacing:.2,borderRadius:2,textTransform:"none",boxShadow:t=>t.shadows[1],"&:hover":{boxShadow:t=>t.shadows[2]}},children:"Importar"})]}),e.jsx("ul",{ref:re,className:"list",style:{maxHeight:le||void 0,overflowY:"auto",overflowX:"hidden"},children:i.data.filter(t=>{let a=!!t.processed_at;const n=T[t.id];if(typeof n=="string"&&n!==(t.observacao||"")&&(a=!1),(s==null?void 0:s.id)===t.id&&k&&(a=!1),f==="pending"&&a||f==="processed"&&!a)return!1;if(!S)return!0;const d=S.toLowerCase();return[t.nome,t.email,t.empresa,t.telefone,t.nif].filter(Boolean).some(u=>String(u).toLowerCase().includes(d))}).map(t=>{var d;let a=!!t.processed_at;const n=T[t.id];return typeof n=="string"&&n!==(t.observacao||"")&&(a=!1),(s==null?void 0:s.id)===t.id&&k&&(a=!1),e.jsxs("li",{className:`list-item ${a?"processed":"pending"} ${(s==null?void 0:s.id)===t.id?"active":""}`,onClick:()=>Se(t.id),tabIndex:0,onKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),Se(t.id))},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700},children:t.nome}),e.jsx("div",{className:"muted",style:{fontSize:".85rem"},children:t.email})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{className:"muted",style:{fontSize:".8rem"},children:`#${(d=t.numero??t.id)==null?void 0:d.toString().padStart(3,"0")}`}),a?e.jsx("span",{className:"badge badge-success",children:"Processado"}):e.jsx("span",{className:"badge badge-danger",children:"Pendente"})]})]},t.id)})}),e.jsx(c,{className:"flex items-center",sx:{mt:1,gap:1,flexWrap:"wrap",alignItems:"center",justifyContent:"center"},children:e.jsxs(c,{className:"flex",sx:{gap:1,alignItems:"center",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(I,{size:"small",variant:"outlined",onClick:()=>b(t=>t>1?t-1:t),"aria-disabled":(((ce=i.meta)==null?void 0:ce.current_page)||x)<=1,sx:t=>({borderRadius:1.5,minWidth:36,fontWeight:800,borderColor:t.palette.divider,color:t.palette.text.primary}),children:"Anterior"}),Array.from({length:((Oe=i.meta)==null?void 0:Oe.last_page)||1},(t,a)=>a+1).map(t=>{var a;return e.jsx(I,{size:"small",variant:(((a=i.meta)==null?void 0:a.current_page)||x)===t?"contained":"outlined",onClick:()=>b(t),sx:n=>{var l;return(((l=i.meta)==null?void 0:l.current_page)||x)===t?{bgcolor:(n.palette.mode==="dark",n.palette.grey[900]),color:n.palette.primary.contrastText,borderRadius:1.5,minWidth:36,fontWeight:800}:{borderColor:n.palette.divider,color:n.palette.text.primary,borderRadius:1.5,minWidth:36,fontWeight:800}},children:t},t)}),e.jsx(I,{size:"small",variant:"outlined",onClick:()=>b(t=>{var a;return t<(((a=i.meta)==null?void 0:a.last_page)||1)?t+1:t}),"aria-disabled":(((qe=i.meta)==null?void 0:qe.current_page)||x)>=(((Ue=i.meta)==null?void 0:Ue.last_page)||1),sx:t=>({borderRadius:1.5,minWidth:36,fontWeight:800,borderColor:t.palette.divider,color:t.palette.text.primary}),children:"Próxima"})]})})]}),e.jsxs("div",{className:"card",ref:fe,style:{display:"flex",flexDirection:"column",gap:12,minWidth:0,paddingInline:"clamp(12px, 3vw, 16px)"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"card-title",style:{marginTop:0},children:"Detalhes do Contato"}),s&&e.jsxs("div",{className:"flex items-center gap-2",children:[!s.processed_at||typeof T[s.id]=="string"&&T[s.id]!==(s.observacao||"")||k?e.jsx("span",{className:"badge badge-danger",children:"Pendente"}):e.jsx("span",{className:"badge badge-success",children:"Processado"}),e.jsx("span",{className:"muted",style:{fontSize:".85rem"},children:`#${(Ve=s.numero??s.id)==null?void 0:Ve.toString().padStart(3,"0")}`})]})]}),s?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:1.25},children:[e.jsxs(c,{sx:{minWidth:0},children:[e.jsx("label",{className:"label",children:"Nome Completo"}),e.jsx("div",{className:"field readonly",style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:s.nome})]}),e.jsxs(c,{sx:{minWidth:0},children:[e.jsx("label",{className:"label",children:"Empresa"}),e.jsx("div",{className:"field readonly",style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:s.empresa})]}),e.jsxs(c,{sx:{minWidth:0},children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("div",{className:"field readonly",style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:s.email})]}),e.jsxs(c,{sx:{minWidth:0},children:[e.jsx("label",{className:"label",children:"NIF"}),e.jsx("div",{className:"field readonly",style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:s.nif||"—"})]}),e.jsxs(c,{sx:{minWidth:0},children:[e.jsx("label",{className:"label",children:"Telemóvel"}),e.jsx("div",{className:"field readonly",style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:String(s.telefone??"").replace(/\s+/g,"")})]}),e.jsxs(c,{sx:{minWidth:0},children:[e.jsx("label",{className:"label",children:"Data de Criação"}),e.jsx("div",{className:"field readonly",style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:s.created_at?new Date(s.created_at).toLocaleString():"—"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"label",style:{marginBottom:0},children:"Informações Adicionais"}),(o==null?void 0:o.is_admin)&&e.jsx(I,{size:"small",variant:"outlined",onClick:()=>{const t=T[s.id];j(typeof t=="string"?t:s.observacao||""),L(!1),setTimeout(()=>{var a;return(a=xe.current)==null?void 0:a.focus()},0)},children:"Editar"})]}),e.jsx("div",{className:"field readonly",style:{marginTop:6},children:s.observacao||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Observação do Processamento"}),e.jsx("textarea",{ref:xe,className:"textarea",value:me,onChange:t=>{const a=t.target.value;j(a);const n=(s==null?void 0:s.observacao)||"";L(a!==n),s!=null&&s.id&&oe(l=>({...l,[s.id]:a}))},rows:6,placeholder:"Digite suas observações sobre o processamento deste registro..."}),k&&e.jsx("div",{className:"muted",style:{color:"var(--danger)",marginTop:6},children:"Pendente: você alterou a observação e precisa gravar."})]}),e.jsxs(c,{className:"flex items-center gap-3",sx:{justifyContent:{xs:"stretch",sm:"flex-end"},flexWrap:"wrap",gap:1.25},children:[e.jsx(I,{variant:"outlined",onClick:()=>{V(null),j(""),L(!1)},sx:{width:{xs:"100%",sm:"auto"}},children:"Cancelar"}),e.jsx(I,{variant:"contained",onClick:Ae,sx:{width:{xs:"100%",sm:"auto"}},children:"Gravar Registro"}),(o==null?void 0:o.is_admin)&&e.jsx(I,{variant:"outlined",color:"error",onClick:()=>{ge((s==null?void 0:s.id)??null),J(s?s.numero??s.id:null),se(!0)},sx:{width:{xs:"100%",sm:"auto"}},children:"Excluir"}),ue&&e.jsx("span",{className:"muted",children:ue})]})]}):e.jsx("div",{className:"muted",children:"Selecione um registro à esquerda para ver os detalhes."})]})]}),e.jsxs(Lt,{open:C,onClose:()=>se(!1),children:[e.jsx(Ft,{children:"Confirmar exclusão"}),e.jsx(At,{children:(()=>{const t=ie??(s==null?void 0:s.id);let a=H??(s&&s.id===t?s.numero??s.id:null);if(a==null&&t!=null){const l=((i==null?void 0:i.data)||[]).find(d=>d.id===t);l&&(a=l.numero??l.id)}const n=a!=null?`#${String(a).padStart(3,"0")}`:t!=null?`#${String(t).padStart(3,"0")}`:"";return e.jsxs(e.Fragment,{children:["Tem certeza que deseja excluir o registro ",n,"? Esta ação não pode ser desfeita."]})})()}),e.jsxs(_t,{children:[e.jsx(I,{onClick:()=>se(!1),children:"Cancelar"}),e.jsx(I,{color:"error",variant:"contained",onClick:async()=>{const t=ie??(s==null?void 0:s.id);se(!1),await _e(t),ge(null),J(null)},children:"Excluir"})]})]})]})}),e.jsx(c,{sx:{width:"100%",bgcolor:t=>t.palette.mode==="dark"?t.palette.background.paper:"#FFFFFF",borderTop:t=>`1px solid ${t.palette.divider}`},children:e.jsx(Qe,{maxWidth:!1,sx:{maxWidth:"1680px",mx:"auto",px:{xs:1.5,sm:2,md:2.5}},children:e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:1.25,minHeight:56,textAlign:"center"},children:[e.jsx(te,{variant:"body2",sx:{fontWeight:500,color:t=>t.palette.text.secondary},children:"© 2025 Sistema Sol-Online • Módulo de Movimentação • Versão 1.0"}),(o==null?void 0:o.is_admin)&&e.jsxs(c,{sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"center",mt:.75,"& .MuiChip-label":{fontWeight:500}},children:[e.jsx(q,{size:"medium",label:`${G.total} registros`,color:"primary",variant:"outlined"}),e.jsx(q,{size:"medium",label:`${ve} pendentes`,color:"error",variant:"outlined"}),e.jsx(q,{size:"medium",label:`${we} processados`,color:"success",variant:"outlined"})]})]})})})]})}export{Xt as default};
